<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core">
    <h:head>
        <title>Enregistrer une visite - Indonésie</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://fonts.googleapis.com/css2?family=Lobster&amp;display=swap" rel="stylesheet"/>
        <style>body { font-family: 'Lobster', cursive; }</style>
    </h:head>
    <h:body class="min-h-screen bg-gray-50">
        <div class="container mx-auto px-4 py-8 max-w-2xl">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Enregistrer une visite</h2>

                <div class="mb-4">
                    <h:messages globalOnly="true" errorClass="text-red-600" infoClass="text-green-600"/>
                </div>

                <f:metadata>
                    <f:viewAction action="#{visiteBean.preparerDepuisSession}" />
                </f:metadata>

                <h:form>
                    <div class="space-y-4">
                        <div>
                            <h:outputLabel for="selectLieu" value="Choisir un lieu" class="block text-sm font-medium text-gray-700 mb-2"/>
                            <h:selectOneMenu id="selectLieu" value="#{lieuBean.selectedLieu}" class="w-full px-3 py-2 border border-gray-300 rounded">
                                <f:selectItems value="#{lieuBean.lieux}" var="lieu" itemValue="#{lieu.id}" itemLabel="#{lieu.nom}" />
                                <f:ajax execute="@this" listener="#{lieuBean.updateWeatherMessage}" render="weather lieuIdHidden lieuNom"/>
                            </h:selectOneMenu>
                        </div>

                        <div>
                            <h:outputLabel for="dateVisite" value="Date de visite" class="block text-sm font-medium text-gray-700 mb-2"/>
                            <h:inputText id="dateVisite" value="#{visiteBean.dateVisite}" class="w-full px-3 py-2 border border-gray-300 rounded"/>

                        <div rendered="#{not empty lieuBean.weatherMessage}">
                            <h:outputLabel value="Météo actuelle" class="block text-sm font-medium text-gray-700 mb-2"/>
                            <h:outputText id="weather" value="#{lieuBean.weatherMessage}" escape="false" styleClass="text-sm text-gray-700 block mb-3"/>
                        </div>
                            <h:message for="dateVisite" class="text-red-600 text-xs"/>
                        </div>

                        <div>
                            <h:outputLabel for="tempsPasse" value="Temps passé (heures)" class="block text-sm font-medium text-gray-700 mb-2"/>
                            <h:inputText id="tempsPasse" value="#{visiteBean.tempsPasse}" class="w-full px-3 py-2 border border-gray-300 rounded"/>
                            <h:message for="tempsPasse" class="text-red-600 text-xs"/>
                        </div>

                        <div>
                            <h:outputLabel for="depense" value="Dépense (IDR)" class="block text-sm font-medium text-gray-700 mb-2"/>
                            <h:inputText id="depense" value="#{visiteBean.depense}" class="w-full px-3 py-2 border border-gray-300 rounded"/>
                            <h:message for="depense" class="text-red-600 text-xs"/>
                        </div>

                        <div>
                            <h:outputLabel for="observations" value="Observations" class="block text-sm font-medium text-gray-700 mb-2"/>
                            <h:inputTextarea id="observations" value="#{visiteBean.observations}" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded resize-none"/>
                        </div>

                        <div class="flex gap-3">
                            <h:commandButton value="Enregistrer" action="#{visiteBean.ajouterVisite}" styleClass="bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded"/>
                            <h:commandButton value="Annuler" action="#{navigationBean.voirAccueil}" immediate="true" styleClass="bg-gray-200 hover:bg-gray-300 text-gray-800 py-2 px-4 rounded"/>
                        </div>
                    </div>
                </h:form>
            </div>
        </div>
    </h:body>
</html>
